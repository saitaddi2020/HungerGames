rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    // ğŸ§ PRODUCTS â€” Only approved caterers and Super Admin can upload
    match /products/{filename} {
      allow read: if true;
      allow write: if isApprovedCaterer() || isSuperAdmin();
    }

    // ğŸª SHOP IMAGES â€” Caterers can upload their own shop images
    match /shop_images/{userId}/{filename} {
      allow read: if true;
      allow write: if request.auth != null &&
                   (request.auth.uid == userId || isSuperAdmin());
    }

    // ğŸ“¢ BANNERS â€” Only Super Admin can upload
    match /banners/{filename} {
      allow read: if true;
      allow write: if isSuperAdmin();
    }

    // ğŸ§ USER PROFILE PICS â€” Each user can write to their own
    match /profile_pics/{userId}/{filename} {
      allow read: if true;
      allow write: if request.auth != null &&
                   (request.auth.uid == userId || isSuperAdmin());
    }

    // ğŸš« Block all other unspecified paths
    match /{allOtherPaths=**} {
      allow read, write: if false;
    }
  }
}

// âœ… Allow only if user is an approved admin in 'admins' collection
function isApprovedCaterer() {
  return request.auth != null &&
         get(/databases/(default)/documents/admins/$(request.auth.uid)).data.approved == true;
}

// âœ… Allow if user is the Super Admin
function isSuperAdmin() {
  return request.auth != null &&
         request.auth.token.email == "saitaddi1432@gmail.com";
}
